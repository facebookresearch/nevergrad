<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Parametrizing your optimization &mdash; nevergrad  documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples - Nevergrad for machine learning" href="machinelearning.html" />
    <link rel="prev" title="How to perform optimization" href="optimization.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            nevergrad
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">How to perform optimization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Parametrizing your optimization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#preliminary-examples">Preliminary examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametrization">Parametrization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parametrizing-external-code">Parametrizing external code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tips-and-caveats">Tips and caveats</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="machinelearning.html">Examples - Nevergrad for machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimizers_ref.html">Optimizers API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="parametrization_ref.html">Parametrization API reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarking.html">Running algorithm benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="r.html">Examples - Nevergrad for R</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Examples of benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="pyomo.html">Examples - Working with Pyomo model</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows.html">Installation and configuration on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Nevergrad</a></li>
<li class="toctree-l1"><a class="reference internal" href="opencompetition2020.html">Open Optimization Competition 2020</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nevergrad</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Parametrizing your optimization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/parametrization.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="parametrizing-your-optimization">
<span id="parametrizing"></span><h1>Parametrizing your optimization<a class="headerlink" href="#parametrizing-your-optimization" title="Permalink to this heading"></a></h1>
<p><strong>Please note that parametrization is still a work in progress and changes are on their way (including for this documentation)! We are trying to update it to make it simpler and simpler to use (all feedbacks are welcome ;) ), with the side effect that there will be breaking changes.</strong></p>
<p>The aim of parametrization is to specify what are the parameters that the optimization should be performed upon.
The parametrization subpackage will help you do thanks to:</p>
<ul class="simple">
<li><p>the <code class="code docutils literal notranslate"><span class="pre">parameter</span></code> modules (accessed by the shortcut <code class="code docutils literal notranslate"><span class="pre">nevergrad.p</span></code>) providing classes that should be used to specify each parameter.</p></li>
<li><p>the <code class="code docutils literal notranslate"><span class="pre">FolderFunction</span></code> which helps transform any code into a Python function in a few lines. This can be especially helpful to optimize parameters in non-Python 3.6+ code (C++, Octave, etc…) or parameters in scripts.</p></li>
</ul>
<section id="preliminary-examples">
<h2>Preliminary examples<a class="headerlink" href="#preliminary-examples" title="Permalink to this heading"></a></h2>
<p>The code below defines a parametrization that creates a <code class="code docutils literal notranslate"><span class="pre">dict</span></code> with 3 elements:</p>
<ul class="simple">
<li><p>a log-distributed scalar.</p></li>
<li><p>an array of size 2.</p></li>
<li><p>a random letter, which is either <code class="code docutils literal notranslate"><span class="pre">a</span></code>, <code class="code docutils literal notranslate"><span class="pre">b</span></code> or <code class="code docutils literal notranslate"><span class="pre">c</span></code>,</p></li>
</ul>
<p>The main attribute for users is the <code class="code docutils literal notranslate"><span class="pre">value</span></code> attribute, which provides the value of the defined <code class="code docutils literal notranslate"><span class="pre">dict</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">nevergrad</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ng</span>

<span class="c1"># build a parameter providing a dict value:</span>
<span class="n">param</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Dict</span><span class="p">(</span>
    <span class="c1"># logarithmically distributed float</span>
    <span class="n">log</span><span class="o">=</span><span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Log</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span>
    <span class="c1"># one-dimensional array of length 2</span>
    <span class="n">array</span><span class="o">=</span><span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Array</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)),</span>
    <span class="c1"># character, either &quot;a&quot; or &quot;b or &quot;c&quot;.</span>
    <span class="n">char</span><span class="o">=</span><span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]),</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="c1"># {&#39;log&#39;: 0.01,</span>
<span class="c1">#  &#39;array&#39;: array([0., 0.]),</span>
<span class="c1">#  &#39;char&#39;: &#39;a&#39;}</span>
</pre></div>
</div>
<p>Parametrization is central in <code class="code docutils literal notranslate"><span class="pre">nevergrad</span></code> since it is the interface between the optimization domain
defined by the users, and the standardized representations used by the optimizers. The snippet below
shows how to duplicate the parameter (i.e. spawn a child from the parameter), manually updating the value,
and export to the standardized space. Unless implementing an algorithm, users should not have any need
for this export. However, setting the <code class="code docutils literal notranslate"><span class="pre">value</span></code> manually can be used to provide an initial prior to
the optimizer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new instance</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">spawn_child</span><span class="p">()</span>
<span class="c1"># update its value</span>
<span class="n">child</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;log&quot;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">12.0</span><span class="p">,</span> <span class="mf">13.0</span><span class="p">]),</span> <span class="s2">&quot;char&quot;</span><span class="p">:</span> <span class="s2">&quot;c&quot;</span><span class="p">}</span>

<span class="c1"># export to standardized space</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_standardized_data</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">param</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1"># np.array([12., 13.,  0.,  0., 0.69, 0.90])</span>
</pre></div>
</div>
<p>Similarly, optimizers can use <code class="code docutils literal notranslate"><span class="pre">mutate</span></code> and <code class="code docutils literal notranslate"><span class="pre">recombine</span></code> methods to update the value of parameters.
You can easily check how parameters mutate, and mutation of <code class="code docutils literal notranslate"><span class="pre">Array</span></code> variables can be adapted to your need:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">param</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="c1"># {&#39;log&#39;: 0.155,</span>
<span class="c1">#  &#39;array&#39;: np.array([-0.966, 0.045]),</span>
<span class="c1">#  &#39;char&#39;: &#39;a&#39;}</span>

<span class="c1"># increase the step/sigma for array</span>
<span class="c1"># (note that it&#39;s advised to to this during the creation</span>
<span class="c1">#  of the variable:</span>
<span class="c1">#  array=ng.p.Array(shape=(2,)).set_mutation(sigma=10))</span>
<span class="n">param</span><span class="p">[</span><span class="s2">&quot;array&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_mutation</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
<span class="n">param</span><span class="o">.</span><span class="n">mutate</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="c1"># {&#39;log&#39;: 0.155,</span>
<span class="c1">#  &#39;array&#39;: np.array([-9.47, 8.38]),  # larger mutation</span>
<span class="c1">#  &#39;char&#39;: &#39;a&#39;}</span>

</pre></div>
</div>
<p>Note that optimizer <code class="code docutils literal notranslate"><span class="pre">freeze</span></code> candidates to avoid modification their modification and border effects, however you can always spawn new parameters from them.</p>
<p>Parametrization is also responsible for the randomness in nevergrad. They have a <code class="code docutils literal notranslate"><span class="pre">random_state</span></code> which can be set for reproducibility</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">param</span><span class="o">.</span><span class="n">random_state</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading"></a></h2>
<p>7 types of parameters are currently provided:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">Choice(items)</span></code>: describes a parameter which can take values within the provided list of (usually unordered categorical) items, and for which transitions are global (from one item to any other item). The returned element will be sampled as the softmax of the values on these dimensions. Be cautious: this process is non-deterministic and makes the function evaluation noisy.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">TransitionChoice(items)</span></code>: describes a parameter which can take values within the provided list of (usually ordered) items, and for which transitions are local (from one item to close items).</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Array(shape=shape)</span></code>: describes a <code class="code docutils literal notranslate"><span class="pre">np.ndarray</span></code> of any shape. The bounds of the array and the mutation of this array can be specified (see <code class="code docutils literal notranslate"><span class="pre">set_bounds</span></code>, <code class="code docutils literal notranslate"><span class="pre">set_mutation</span></code>). This makes it a very flexible type of parameter. Eg. <code class="code docutils literal notranslate"><span class="pre">Array(shape=(2,</span> <span class="pre">3)).set_bounds(0,</span> <span class="pre">2)</span></code> encodes for an array of shape <code class="code docutils literal notranslate"><span class="pre">(2,</span> <span class="pre">3)</span></code>, with values bounded between 0 and 2. It can be also set to an array of integers (see <code class="code docutils literal notranslate"><span class="pre">set_integer_casting</span></code>)</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Scalar()</span></code>: describes a scalar. This parameter inherits from all <code class="code docutils literal notranslate"><span class="pre">Array</span></code> methods, so it can be bounded, projected to integers and mutation rate can be customized.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Log(lower,</span> <span class="pre">upper)</span></code>: describes log distributed data between two bounds. Under the hood this uses an <code class="code docutils literal notranslate"><span class="pre">Scalar</span></code> with appropriate specifications for bounds and mutations.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Instrumentation(*args,</span> <span class="pre">**kwargs)</span></code>: a container for other parameters. Values of parameters in the <code class="code docutils literal notranslate"><span class="pre">args</span></code> will be returned as a <code class="code docutils literal notranslate"><span class="pre">tuple</span></code> by <code class="code docutils literal notranslate"><span class="pre">param.args</span></code>, and
values of parameters in the <code class="code docutils literal notranslate"><span class="pre">kwargs</span></code> will be returned as a <code class="code docutils literal notranslate"><span class="pre">dict</span></code> by <code class="code docutils literal notranslate"><span class="pre">param.kwargs</span></code> (in practice, <code class="code docutils literal notranslate"><span class="pre">param.value</span> <span class="pre">==</span> <span class="pre">(param.args,</span> <span class="pre">param.kwargs)</span></code>).
This serves to parametrize functions taking multiple arguments, since you can then call the function with <code class="code docutils literal notranslate"><span class="pre">func(*param.args,</span> <span class="pre">**param.kwargs)</span></code>.</p></li>
</ul>
<p>Follow the link to the API reference for more details and initialization options:</p>
<table class="autosummary longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Array" title="nevergrad.p.Array"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Array</span></code></a>(*[, init, shape, lower, ...])</p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Scalar" title="nevergrad.p.Scalar"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Scalar</span></code></a>([init, lower, upper, ...])</p></td>
<td><p>Parameter representing a scalar.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Log" title="nevergrad.p.Log"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Log</span></code></a>(*[, init, exponent, lower, ...])</p></td>
<td><p>Parameter representing a positive variable, mutated by Gaussian mutation in log-scale.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Dict" title="nevergrad.p.Dict"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Dict</span></code></a>(**parameters)</p></td>
<td><p>Dictionary-valued parameter.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Tuple" title="nevergrad.p.Tuple"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Tuple</span></code></a>(*parameters)</p></td>
<td><p>Tuple-valued parameter.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Instrumentation" title="nevergrad.p.Instrumentation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Instrumentation</span></code></a>(*args, **kwargs)</p></td>
<td><p>Container of parameters available through <cite>args</cite> and <cite>kwargs</cite> attributes.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.Choice" title="nevergrad.p.Choice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.Choice</span></code></a>(choices[, repetitions, ...])</p></td>
<td><p>Unordered categorical parameter, randomly choosing one of the provided choice options as a value.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="parametrization_ref.html#nevergrad.p.TransitionChoice" title="nevergrad.p.TransitionChoice"><code class="xref py py-obj docutils literal notranslate"><span class="pre">nevergrad.p.TransitionChoice</span></code></a>(choices[, ...])</p></td>
<td><p>Categorical parameter, choosing one of the provided choice options as a value, with continuous transitions.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="parametrization">
<h2>Parametrization<a class="headerlink" href="#parametrization" title="Permalink to this heading"></a></h2>
<p>Parametrization helps you define the parameters you want to optimize upon.
Currently most algorithms make use of it to help convert the parameters into the “standardized data” space (a vector space spanning all the real values),
where it is easier to define operations.</p>
<p>Let’s define the parametrization for a function taking 3 positional arguments and one keyword argument <code class="code docutils literal notranslate"><span class="pre">value</span></code>.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">arg1</span> <span class="pre">=</span> <span class="pre">ng.p.Choice([[&quot;Helium&quot;,</span> <span class="pre">&quot;Nitrogen&quot;,</span> <span class="pre">&quot;Oxygen&quot;]])</span></code> is the first positional argument, which can take 3 possible values, without any order, the selection is made stochasticly through the sampling of a softmax. It is encoded by 3 values (the softmax weights) in the “standardized space”.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">arg2</span> <span class="pre">=</span> <span class="pre">ng.p.TransitionChoice([&quot;Solid&quot;,</span> <span class="pre">&quot;Liquid&quot;,</span> <span class="pre">&quot;Gas&quot;])</span></code> is the second one, it encodes the choice (i.e. 1 dimension) through a single index which can mutate in a continuous way.</p></li>
<li><p>third argument will be kept constant to <code class="code docutils literal notranslate"><span class="pre">blublu</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">values</span> <span class="pre">=</span> <span class="pre">ng.p.Tuple(ng.p.Scalar().set_integer_casting(),</span> <span class="pre">ng.p.Scalar())</span></code> which represents a tuple of two scalars with different numeric types in the parameter space, and in the “standardized space”</p></li>
</ul>
<p>We then define a parameter holding all these parameters, with a standardized space of dimension 6 (as the sum of the dimensions above):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">arg1</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;Helium&quot;</span><span class="p">,</span> <span class="s2">&quot;Nitrogen&quot;</span><span class="p">,</span> <span class="s2">&quot;Oxygen&quot;</span><span class="p">])</span>
<span class="n">arg2</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">TransitionChoice</span><span class="p">([</span><span class="s2">&quot;Solid&quot;</span><span class="p">,</span> <span class="s2">&quot;Liquid&quot;</span><span class="p">,</span> <span class="s2">&quot;Gas&quot;</span><span class="p">])</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Tuple</span><span class="p">(</span><span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Scalar</span><span class="p">()</span><span class="o">.</span><span class="n">set_integer_casting</span><span class="p">(),</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Scalar</span><span class="p">())</span>

<span class="n">instru</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">Instrumentation</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="s2">&quot;blublu&quot;</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">instru</span><span class="o">.</span><span class="n">dimension</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; 6</span>
</pre></div>
</div>
<p>You can then directly perform optimization on a function given its parametrization:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="k">def</span><span class="w"> </span><span class="nf">myfunction</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">amount</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">amount</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">amount</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">optimizer</span> <span class="o">=</span> <span class="n">ng</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">NGOpt</span><span class="p">(</span><span class="n">parametrization</span><span class="o">=</span><span class="n">instru</span><span class="p">,</span> <span class="n">budget</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">recommendation</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">myfunction</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">recommendation</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="c1"># &gt;&gt;&gt; ((&#39;Helium&#39;, &#39;Gas&#39;, &#39;blublu&#39;), {&#39;value&#39;: (0, 0.0006602471804655007)})</span>
</pre></div>
</div>
<p>Here is a glimpse of what happens on the optimization space:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">instru2</span> <span class="o">=</span> <span class="n">instru</span><span class="o">.</span><span class="n">spawn_child</span><span class="p">()</span><span class="o">.</span><span class="n">set_standardized_data</span><span class="p">([</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">instru2</span><span class="o">.</span><span class="n">args</span> <span class="o">==</span> <span class="p">(</span><span class="s2">&quot;Nitrogen&quot;</span><span class="p">,</span> <span class="s2">&quot;Liquid&quot;</span><span class="p">,</span> <span class="s2">&quot;blublu&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">instru2</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)}</span>
</pre></div>
</div>
<p>With this code:</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">Nitrogen</span></code> is selected because proba(e) = exp(80) / (exp(80) + exp(-80) + exp(-80)) = 1</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">Liquid</span></code> is selected because the index for <cite>Liquid</cite> is around 0 in the standardized space.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">amount=(3,</span> <span class="pre">5.0)</span></code> because the last two values of the standardized space (i.e. 3.0, 5.0) corresponds to the value of the last kwargs.</p></li>
</ul>
</section>
<section id="parametrizing-external-code">
<h2>Parametrizing external code<a class="headerlink" href="#parametrizing-external-code" title="Permalink to this heading"></a></h2>
<p>Sometimes it is completely impractical or impossible to have a simple Python3.6+ function to optimize. This may happen when the code you want to optimize is a script. Even more so if the code you want to optimize is not Python3.6+.</p>
<p>We provide tooling for this situation but this is hacky, so if you can avoid it, <strong>do avoid it</strong>. Otherwise, go through these steps to instrument your code:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>identify the variables</strong> (parameters, constants…) you want to optimize.</p></li>
<li><p><strong>add placeholders</strong> to your code. Placeholders are just tokens of the form <code class="code docutils literal notranslate"><span class="pre">NG_ARG{name|comment}</span></code> where you can modify the name and comment. The name you set will be the one you will need to use as your function argument. In order to avoid breaking your code, the line containing the placeholders can be commented. To notify that the line should be uncommented for parametrization, you’ll need to add “&#64;nevergrad&#64;” at the start of the comment. Here is an example in C which will notify that we want to obtain a function with a <code class="code docutils literal notranslate"><span class="pre">step</span></code> argument which will inject values into the <code class="code docutils literal notranslate"><span class="pre">step_size</span></code> variable of the code:</p></li>
</ul>
</div></blockquote>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="w"> </span><span class="n">step_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span>
<span class="c1">// @nevergrad@ step_size = NG_ARG{step|any comment}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>prepare the command to execute</strong> that will run your code. Make sure that the last printed line is just a float, which is the value to base the optimization upon. We will be doing minimization here, so this value must decrease for better results.</p></li>
<li><p><strong>instantiate</strong> your code into a function using the <code class="code docutils literal notranslate"><span class="pre">FolderFunction</span></code> class:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">nevergrad</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ng</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">nevergrad.parametrization</span><span class="w"> </span><span class="kn">import</span> <span class="n">FolderFunction</span>

<span class="c1"># nevergrad/parametrization/examples contains a script</span>
<span class="n">example_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">ng</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;parametrization&quot;</span> <span class="o">/</span> <span class="s2">&quot;examples&quot;</span>
<span class="n">python</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
<span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">python</span><span class="p">,</span> <span class="s2">&quot;examples/script.py&quot;</span><span class="p">]</span>  <span class="c1"># command to run from right outside the provided folder</span>
<span class="c1"># create a function from the folder</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">FolderFunction</span><span class="p">(</span><span class="n">example_folder</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">clean_copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># print the number of variables of the function:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">placeholders</span><span class="p">)</span>
<span class="c1"># prints: [Placeholder(&#39;value1&#39;, &#39;this is a comment&#39;), Placeholder(&#39;value2&#39;, None), Placeholder(&#39;string&#39;, None)]</span>
<span class="c1"># and run it (the script prints 12 at the end)</span>
<span class="k">assert</span> <span class="n">func</span><span class="p">(</span><span class="n">value1</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">value2</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;blublu&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mf">12.0</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>parametrize</strong> the function (see Parametrization section just above).</p></li>
</ul>
<section id="tips-and-caveats">
<h3>Tips and caveats<a class="headerlink" href="#tips-and-caveats" title="Permalink to this heading"></a></h3>
<blockquote>
<div><ul class="simple">
<li><p>using <code class="code docutils literal notranslate"><span class="pre">FolderFunction</span></code> argument <code class="code docutils literal notranslate"><span class="pre">clean_copy=True</span></code> will copy your folder so that tempering with it during optimization will run different versions of your code.</p></li>
<li><p>under the hood, with or without <code class="code docutils literal notranslate"><span class="pre">clean_copy=True</span></code>, when calling the function, <code class="code docutils literal notranslate"><span class="pre">FolderFunction</span></code> will create symlink copy of the initial folder, remove the files that have tokens, and create new ones with appropriate values. Symlinks are used in order to avoid duplicating large projects, but they have some drawbacks, see next point ;)</p></li>
<li><p>one can add a compilation step to <code class="code docutils literal notranslate"><span class="pre">FolderFunction</span></code> (the compilation just has to be included in the script). However, be extra careful that if the initial folder contains some build files, they could be modified by the compilation step, because of the symlinks. Make sure that during compilation, you remove the build symlinks first! <strong>This feature has not been fool proofed yet!!!</strong></p></li>
<li><p>the following external file types are registered by default: <code class="code docutils literal notranslate"><span class="pre">[&quot;.c&quot;,</span> <span class="pre">&quot;.h&quot;,</span> <span class="pre">&quot;.cpp&quot;,</span> <span class="pre">&quot;.hpp&quot;,</span> <span class="pre">&quot;.py&quot;,</span> <span class="pre">&quot;.m&quot;]</span></code>. Custom file types can be registered using <code class="code docutils literal notranslate"><span class="pre">FolderFunction.register_file_type</span></code> by providing the relevant file suffix as well as the characters that indicate a comment. However, for now, parameters which provide a vector or values (<code class="code docutils literal notranslate"><span class="pre">Array</span></code>) will inject code with a Python format (list) by default, which may not be suitable.</p></li>
</ul>
</div></blockquote>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="optimization.html" class="btn btn-neutral float-left" title="How to perform optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="machinelearning.html" class="btn btn-neutral float-right" title="Examples - Nevergrad for machine learning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, Facebook AI Research.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>